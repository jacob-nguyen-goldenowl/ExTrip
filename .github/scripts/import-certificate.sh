#!/bin/bash

set -euo pipefail
SIGNING_CERTIFICATE_P12_DATA=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
security create-keychain -p "" build.keychain
security list-keychains -s build.keychain
security default-keychain -s build.keychain
security unlock-keychain -p "" build.keychain
security set-keychain-settings
security import <(echo $SIGNING_CERTIFICATE_P12_DATA | base64 --decode) \
                -f pkcs12 \
                -k build.keychain \
                -P "" \
                -T /usr/bin/codesign
security set-key-partition-list -S apple-tool:,apple: -s -k "" build.keychain